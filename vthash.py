#!/usr/bin/python

import simplejson
import urllib
import urllib2
import pprint
import argparse
import sys


def hashcheck(arg_hash):
	"""check hash against the virustotal.com database"""
	url = "https://www.virustotal.com/api/get_file_report.json"
	vtkey = "YOURKEYHERE"

	parameters = {"resource": arg_hash, 
			"key": vtkey }

	data = urllib.urlencode(parameters)
	req = urllib2.Request(url, data)
	response = urllib2.urlopen(req)
	json = response.read()
	data = simplejson.loads(json)
	pprint.pprint(data['report'])

def __main__():
	"""basic menu system"""
	parser = argparse.ArgumentParser(description='virustotal.com hash checker', usage='%(prog)s -h hash')
	parser.add_argument('--hash', dest='hash', help='hash to check')
	parser.add_argument('--version', '-v', action='version', version='%(prog)s 0.1')
	args = parser.parse_args()
	
	global arg_hash
	arg_hash = args.hash

	if not args.hash:
		sys.exit(parser.print_help())

	print ""
	print "checking hash: " + arg_hash
	print ""
	hashcheck(arg_hash)


if __name__ == '__main__':
    __main__()
